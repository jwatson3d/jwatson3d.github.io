---
layout: post
title: How To Build a 2-Tier ASP.NET 4.0 Web Site–Part 3
date: '2010-12-20T06:00:00.001-05:00'
author: John
tags:
- Tutorial
- VisualStudio
- IIS 7.5
- ASP.NET 4.0
- Win7
modified_time: '2010-12-22T10:34:52.794-05:00'
thumbnail: http://lh6.ggpht.com/_BvH8o_BvG-4/TQ10VPDc5dI/AAAAAAAAAQ8/20W5xe8cYak/s72-c/2010-12-01_232940_thumb.png?imgmax=800
blogger_id: tag:blogger.com,1999:blog-2811308028656623966.post-7512710348900535328
blogger_orig_url: http://pragmatic-software.blogspot.com/2010/12/how-to-build-2-tier-aspnet-40-web_20.html
---

Now that <a href="http://pragmatic-software.blogspot.com/2010/12/install-iis-75-on-windows-7.html">IIS 7.5 is installed on Windows 7</a> let’s move on to deploying the website to IIS and testing it there.<br /><ol><li>From the <b><i>Build</i></b> menu choose <strong><em>Publish Web Site</em></strong>:<br /><a href="http://lh5.ggpht.com/_BvH8o_BvG-4/TQ10Un0VlJI/AAAAAAAAAQ4/Eh_Jl7bAgD0/s1600-h/2010-12-01_232940%5B2%5D.png"><img alt="2010-12-01_232940" border="0" height="141" src="http://lh6.ggpht.com/_BvH8o_BvG-4/TQ10VPDc5dI/AAAAAAAAAQ8/20W5xe8cYak/2010-12-01_232940_thumb.png?imgmax=800" style="background-image: none; border-bottom-width: 0px; border-left-width: 0px; border-right-width: 0px; border-top-width: 0px; display: inline; padding-left: 0px; padding-right: 0px; padding-top: 0px;" title="2010-12-01_232940" width="143" /></a><br /></li><li>You can either accept the default location or change it to something else:<br /><a href="http://lh6.ggpht.com/_BvH8o_BvG-4/TQ10VrNuEnI/AAAAAAAAARA/1EWBMYHbf9I/s1600-h/2010-12-01_232958%5B2%5D.png"><img alt="2010-12-01_232958" border="0" height="170" src="http://lh4.ggpht.com/_BvH8o_BvG-4/TQ10WN9iInI/AAAAAAAAARE/GnW1Y14uEcE/2010-12-01_232958_thumb.png?imgmax=800" style="background-image: none; border-bottom-width: 0px; border-left-width: 0px; border-right-width: 0px; border-top-width: 0px; display: inline; padding-left: 0px; padding-right: 0px; padding-top: 0px;" title="2010-12-01_232958" width="244" /></a><br />Make note of the location chosen as you will need it shortly.<br /></li><li>Now let’s configure the website in IIS 7. Launch IIS manager from <b><i>Control Panel</i></b> | <b><i>Administrative Tools</i></b> | <b><i>Internet Information Services (IIS) Manager</i></b>:<br /><a href="http://lh3.ggpht.com/_BvH8o_BvG-4/TQ10WRhsLGI/AAAAAAAAARI/8c_Zbiy7JoQ/s1600-h/2010-12-01_225342%5B2%5D.png"><img alt="2010-12-01_225342" border="0" height="67" src="http://lh6.ggpht.com/_BvH8o_BvG-4/TQ10XVGbGgI/AAAAAAAAARM/f4HHECA8dGY/2010-12-01_225342_thumb.png?imgmax=800" style="background-image: none; border-bottom-width: 0px; border-left-width: 0px; border-right-width: 0px; border-top-width: 0px; display: inline; padding-left: 0px; padding-right: 0px; padding-top: 0px;" title="2010-12-01_225342" width="244" /></a><br /><a href="http://lh4.ggpht.com/_BvH8o_BvG-4/TQ10Xlm87XI/AAAAAAAAARQ/0sQjVEX6Fmo/s1600-h/2010-12-01_225416%5B2%5D.png"><img alt="2010-12-01_225416" border="0" height="47" src="http://lh3.ggpht.com/_BvH8o_BvG-4/TQ10YNaxf2I/AAAAAAAAARU/4OqnyXECA3g/2010-12-01_225416_thumb.png?imgmax=800" style="background-image: none; border-bottom-width: 0px; border-left-width: 0px; border-right-width: 0px; border-top-width: 0px; display: inline; padding-left: 0px; padding-right: 0px; padding-top: 0px;" title="2010-12-01_225416" width="244" /></a><br />Hint: IIS Manager is the configuration tool for IIS and you’ll be jumping into it often. You can use the Run dialog for faster access via the <strong>Windows + R</strong> then typing “<strong>inetmgr</strong>”:<br /><br /><a href="http://lh6.ggpht.com/_BvH8o_BvG-4/TQWRsVQTn8I/AAAAAAAAAPo/uA0yJOz0JwA/s1600-h/2010-12-01_225504%5B2%5D.png"><img alt="2010-12-01_225504" border="0" height="201" src="http://lh4.ggpht.com/_BvH8o_BvG-4/TQWRsj4cLrI/AAAAAAAAAPs/p1ffzEOfqQs/2010-12-01_225504_thumb.png?imgmax=800" style="background-image: none; border-bottom-width: 0px; border-left-width: 0px; border-right-width: 0px; border-top-width: 0px; display: inline; padding-left: 0px; padding-right: 0px; padding-top: 0px;" title="2010-12-01_225504" width="212" /></a></li><li> Expand the tree control on the left, right-click on <b><i>Default Web Site</i></b> then right click and choose <b><i>Add Application</i></b>:<br /><a href="http://lh3.ggpht.com/_BvH8o_BvG-4/TQ10YfX0bDI/AAAAAAAAARY/LY7yrm39MzU/s1600-h/2010-12-01_233031%5B2%5D.png"><img alt="2010-12-01_233031" border="0" height="130" src="http://lh5.ggpht.com/_BvH8o_BvG-4/TQ10Yxl4nZI/AAAAAAAAARc/uy2APkW2Nh0/2010-12-01_233031_thumb.png?imgmax=800" style="background-image: none; border-bottom-width: 0px; border-left-width: 0px; border-right-width: 0px; border-top-width: 0px; display: inline; padding-left: 0px; padding-right: 0px; padding-top: 0px;" title="2010-12-01_233031" width="244" /></a></li><li> Type in an <b><i>Alias</i></b> name that will be used as the website name when browsing, Select the <b><i>ASP.NET v4.0 Application pool</i></b> and choose the same <b><i>Physical path</i></b> where you just published the website to previously. You should click the <b><i>Test Settings</i></b> button to verify that Authentication and Authorization are configured correctly:<br /><a href="http://lh4.ggpht.com/_BvH8o_BvG-4/TQ10Z01HGHI/AAAAAAAAARg/YXtLe3Dx7Yk/s1600-h/2010-12-01_233205%5B2%5D.png"><img alt="2010-12-01_233205" border="0" height="169" src="http://lh4.ggpht.com/_BvH8o_BvG-4/TQ10aGkunDI/AAAAAAAAARk/7i7QM2goUtQ/2010-12-01_233205_thumb.png?imgmax=800" style="background-image: none; border-bottom-width: 0px; border-left-width: 0px; border-right-width: 0px; border-top-width: 0px; display: inline; padding-left: 0px; padding-right: 0px; padding-top: 0px;" title="2010-12-01_233205" width="244" /></a><br /><a href="http://lh4.ggpht.com/_BvH8o_BvG-4/TQ10aQ-1cDI/AAAAAAAAARo/7y2N2oSshWs/s1600-h/2010-12-01_233703%5B2%5D.png"><img alt="2010-12-01_233703" border="0" height="165" src="http://lh5.ggpht.com/_BvH8o_BvG-4/TQ10a4VA-fI/AAAAAAAAARs/uOlYiktzS6g/2010-12-01_233703_thumb.png?imgmax=800" style="background-image: none; border-bottom-width: 0px; border-left-width: 0px; border-right-width: 0px; border-top-width: 0px; display: inline; padding-left: 0px; padding-right: 0px; padding-top: 0px;" title="2010-12-01_233703" width="244" /></a></li><li> If you received the above Authorization error it means that IIS does not have permission to access the folder where you published the website to. If this occurs, click <strong><em>Close</em></strong> then <strong><em>OK</em></strong> to complete the creation of the application. Back in the tree view control right-click on <b><i>Edit Permissions</i></b> to grant the IIS web server permission to the publish folder:<br /><a href="http://lh5.ggpht.com/_BvH8o_BvG-4/TQ10bIbn_JI/AAAAAAAAARw/XuPMkPtJcc0/s1600-h/2010-12-01_233315%5B2%5D.png"><img alt="2010-12-01_233315" border="0" height="137" src="http://lh4.ggpht.com/_BvH8o_BvG-4/TQ10bSNxuoI/AAAAAAAAAR0/3HzwA7kdqpA/2010-12-01_233315_thumb.png?imgmax=800" style="background-image: none; border-bottom-width: 0px; border-left-width: 0px; border-right-width: 0px; border-top-width: 0px; display: inline; padding-left: 0px; padding-right: 0px; padding-top: 0px;" title="2010-12-01_233315" width="244" /></a></li><li> On the Security tab choose <b><i>Edit</i></b>, then <b><i>Add</i></b>, then <b><i>Advanced</i></b>, and finally <b><i>Find Now</i></b>:<br /><a href="http://lh5.ggpht.com/_BvH8o_BvG-4/TQ10bke1s5I/AAAAAAAAAR4/LOKJy6e5zS4/s1600-h/2010-12-01_233348%5B2%5D.png"><img alt="2010-12-01_233348" border="0" height="173" src="http://lh3.ggpht.com/_BvH8o_BvG-4/TQ10cA2Zd2I/AAAAAAAAAR8/Gxt-bjTxaRU/2010-12-01_233348_thumb.png?imgmax=800" style="background-image: none; border-bottom-width: 0px; border-left-width: 0px; border-right-width: 0px; border-top-width: 0px; display: inline; padding-left: 0px; padding-right: 0px; padding-top: 0px;" title="2010-12-01_233348" width="244" /></a><a href="http://lh5.ggpht.com/_BvH8o_BvG-4/TQ10cZyud0I/AAAAAAAAASA/aN1_bnBpPCc/s1600-h/2010-12-01_233404%5B2%5D.png"><img alt="2010-12-01_233404" border="0" height="197" src="http://lh3.ggpht.com/_BvH8o_BvG-4/TQ10chi3kiI/AAAAAAAAASE/_lHPSUQHAM8/2010-12-01_233404_thumb.png?imgmax=800" style="background-image: none; border-bottom-width: 0px; border-left-width: 0px; border-right-width: 0px; border-top-width: 0px; display: inline; padding-left: 0px; padding-right: 0px; padding-top: 0px;" title="2010-12-01_233404" width="244" /></a><a href="http://lh3.ggpht.com/_BvH8o_BvG-4/TQ10dBA5fnI/AAAAAAAAASI/4vnSNf5PY78/s1600-h/2010-12-01_233423%5B2%5D.png"><img alt="2010-12-01_233423" border="0" height="225" src="http://lh5.ggpht.com/_BvH8o_BvG-4/TQ10dVt-NKI/AAAAAAAAASM/qQU88xyGoGs/2010-12-01_233423_thumb.png?imgmax=800" style="background-image: none; border-bottom-width: 0px; border-left-width: 0px; border-right-width: 0px; border-top-width: 0px; display: inline; padding-left: 0px; padding-right: 0px; padding-top: 0px;" title="2010-12-01_233423" width="244" /></a><a href="http://lh3.ggpht.com/_BvH8o_BvG-4/TQ10dzZahAI/AAAAAAAAASQ/gSIcYXAW_iM/s1600-h/2010-12-01_233445%5B2%5D.png"><img alt="2010-12-01_233445" border="0" height="202" src="http://lh4.ggpht.com/_BvH8o_BvG-4/TQ10eXwpnEI/AAAAAAAAASU/4CSjSwaglT4/2010-12-01_233445_thumb.png?imgmax=800" style="background-image: none; border-bottom-width: 0px; border-left-width: 0px; border-right-width: 0px; border-top-width: 0px; display: inline; padding-left: 0px; padding-right: 0px; padding-top: 0px;" title="2010-12-01_233445" width="244" /></a></li><li> From the list of users and groups use <b><i>Control + click</i></b> to select the follow three:  <br /><ul><li>IIS_IUSRS<br /></li><li>IUSR<br /></li><li>NETWORK SERVICE </li> </ul><a href="http://lh4.ggpht.com/_BvH8o_BvG-4/TQ10e5-fE6I/AAAAAAAAASY/fOSyuE-kPmc/s1600-h/2010-12-01_233512%5B2%5D.png"><img alt="2010-12-01_233512" border="0" height="244" src="http://lh6.ggpht.com/_BvH8o_BvG-4/TQ10fYcj1wI/AAAAAAAAASc/cb1ZlpEcgYs/2010-12-01_233512_thumb.png?imgmax=800" style="background-image: none; border-bottom-width: 0px; border-left-width: 0px; border-right-width: 0px; border-top-width: 0px; display: inline; padding-left: 0px; padding-right: 0px; padding-top: 0px;" title="2010-12-01_233512" width="221" /></a> Now you can click <strong><em>OK</em></strong> through until the dialogs are dismissed, right-click on the Website in the tree control again and choose <b><i>Edit Application</i></b> where you can Test Settings again.</li><li> When testing from within Visual Studio we are running under the permissions of ourselves – the account we signed into Windows with. When browsing against IIS, it is IIS that is connecting to the database. Since the IIS web server will be acting as a proxy for the user when accessing the database, you must grant the IIS user permission to the database. Using SQL Server Management Studio, execute the following T-SQL statements:<br /><pre class="sql" name="code">CREATE LOGIN [IIS APPPOOL\ASP.NET v4.0] <br />&nbsp; FROM WINDOWS <br />&nbsp; WITH DEFAULT_DATABASE=[master], <br />&nbsp; DEFAULT_LANGUAGE=[us_english]<br />GO<br /><br />CREATE USER [AdventureWorksUser] <br />&nbsp; FOR LOGIN [IIS APPPOOL\ASP.NET v4.0]<br />GO<br /><br />EXEC sp_addrolemember 'db_datareader', 'AdventureWorksUser'<br />GO<br /></pre><br /><a href="http://lh5.ggpht.com/_BvH8o_BvG-4/TQ10f8-42dI/AAAAAAAAASg/b_2G7jnlHw0/s1600-h/2010-12-02_000021%5B2%5D.png"><img alt="2010-12-02_000021" border="0" height="167" src="http://lh6.ggpht.com/_BvH8o_BvG-4/TQ10gBooNTI/AAAAAAAAASk/V-8OmSTj9TY/2010-12-02_000021_thumb.png?imgmax=800" style="background-image: none; border-bottom: 0px; border-left: 0px; border-right: 0px; border-top: 0px; display: inline; padding-left: 0px; padding-right: 0px; padding-top: 0px;" title="2010-12-02_000021" width="244" /></a></li><li> Finally right-click on the website again, choose <strong><em>Browse</em></strong>:<br /><a href="http://lh6.ggpht.com/_BvH8o_BvG-4/TQ10gtXuv8I/AAAAAAAAASo/WlnQDwn2Kco/s1600-h/2010-12-01_233228%5B2%5D.png"><img alt="2010-12-01_233228" border="0" height="131" src="http://lh6.ggpht.com/_BvH8o_BvG-4/TQ10hYwLqxI/AAAAAAAAASs/MILTMT-w4H4/2010-12-01_233228_thumb.png?imgmax=800" style="background-image: none; border-bottom: 0px; border-left: 0px; border-right: 0px; border-top: 0px; display: inline; padding-left: 0px; padding-right: 0px; padding-top: 0px;" title="2010-12-01_233228" width="244" /></a></li><li> Sit back and enjoy the fruits of your hard labor:<br /><a href="http://lh3.ggpht.com/_BvH8o_BvG-4/TQ10h9eaFNI/AAAAAAAAASw/NdOu6VbZqSg/s1600-h/2010-12-02_000036%5B2%5D.png"><img alt="2010-12-02_000036" border="0" height="98" src="http://lh4.ggpht.com/_BvH8o_BvG-4/TQ10iIkWD8I/AAAAAAAAAS0/g1Q9N9r_aW8/2010-12-02_000036_thumb.png?imgmax=800" style="background-image: none; border-bottom: 0px; border-left: 0px; border-right: 0px; border-top: 0px; display: inline; padding-left: 0px; padding-right: 0px; padding-top: 0px;" title="2010-12-02_000036" width="244" /></a></li> </ol>While testing the site in IIS is not absolutely required, it is helpful to go through the publishing process to help shake out potential problems such as the fact that IIS runs under a service account and not the you (the logged in user) the way Visual Studio’s build in web server does.